var Exam;(function(n){var t=function(){function t(){}return t.ExamTypeFromString=function(t){var i=parseInt(t);switch(i){case 0:return n.ExamType.SIMPLE;case 1:return n.ExamType.MULTIPLE;default:throw new Error("invalid type");}},t.ExamLanguageFromString=function(t){var i=parseInt(t);switch(i){case 0:return n.ExamLanguageAnswers.UL;case 1:return n.ExamLanguageAnswers.FI;case 2:return n.ExamLanguageAnswers.RANDOM;default:throw new Error("invalid language enum");}},t.ExamStateFromString=function(t){switch(t){case"start":return n.ExamState.START;case"current":return n.ExamState.CURRENT;default:throw new Error("Invalid state");}},t}();n.EnumConverter=t})(Exam||(Exam={})),function(n){var t,i,u,r;(function(n){n[n.START=0]="START";n[n.CURRENT=1]="CURRENT"})(n.ExamState||(n.ExamState={}));t=n.ExamState,function(n){n[n.SIMPLE=0]="SIMPLE";n[n.MULTIPLE=1]="MULTIPLE"}(n.ExamType||(n.ExamType={}));i=n.ExamType,function(n){n[n.UL=0]="UL";n[n.FI=1]="FI";n[n.RANDOM=2]="RANDOM"}(n.ExamLanguageAnswers||(n.ExamLanguageAnswers={}));u=n.ExamLanguageAnswers;r=function(){function r(){this.m_startController=new n.StartController(this);this.m_examSimpleController=new n.ExamSimpleController(this);this.m_examMultipleController=new n.ExamMultipleController(this)}return r.prototype.getRootElement=function(){return document.getElementById("examwrapper")},r.prototype.run=function(){var i=this.getRootElement();if(i){this.m_state=n.EnumConverter.ExamStateFromString(i.getAttribute("data-state"));switch(this.m_state){case t.START:this.m_startController.add(i);break;case t.CURRENT:break;default:throw new Error("State on examwrapper is missing");}}},r.prototype.getExamState=function(n){var i=n.getAttribute("data-state");switch(i){case"start":return t.START;case"current":return t.CURRENT;default:return t.START}},r.prototype.changeState=function(n,i,r){if(r===void 0&&(r={}),n!==this.m_state){this.m_state=n;i.remove();switch(n){case t.CURRENT:this.stateCurrent(r)}}},r.prototype.stateCurrent=function(n){var t;switch(n.type){case i.SIMPLE:t=this.m_examSimpleController;break;case i.MULTIPLE:t=this.m_examMultipleController}t.add(this.getRootElement(),n)},r}();n.ExamProgram=r}(Exam||(Exam={}));window.addEventListener("load",function(){var n=new Exam.ExamProgram;n.run()}),function(n){var t=function(){function n(){}return n.AjaxPost=function(n,t,i){var r=new XMLHttpRequest;r.addEventListener("load",function(){i(JSON.parse(r.response))},!1);r.addEventListener("error",function(){i({error:"XMLHttpRequest failed"},!0)},!1);r.open("POST",n);r.setRequestHeader("Content-Type","application/json;charset=UTF-8");r.send(JSON.stringify(t))},n}();n.Utility=t}(Exam||(Exam={})),function(n){var t=function(){function t(t){this.m_type=n.ExamType.MULTIPLE;this.m_program=t;this.m_questions=[];this.m_view=new n.ExamMultipleView(this)}return t.prototype.add=function(n,t){this.m_questions.length==0&&(this.m_testId=t.testId,this.m_language=t.language,this.getDataFromServer(n))},t.prototype.getControllerElement=function(){return document.getElementById("")},t.prototype.getDataFromServer=function(t){var r={testId:this.m_testId},i=this;n.Utility.AjaxPost("/exam/api/exam",r,function(n){if(!n.error&&(i.generateQuestions(n.words),n.html!="")){var u=n.html,r=document.createElement("div");r.innerHTML=u;t.appendChild(r.firstChild);i.m_view.renderQuestions(i.m_questions)}})},t.prototype.generateQuestions=function(n){var r=n.length,i,u;if(this.m_questions=[],r<t.WordsPerQuestion)throw new Error("Not enough words to have multiple answers!");for(i=0;i<r;++i)u=this.generateQuestion(i,n),this.m_questions.push(u)},t.prototype.generateQuestion=function(i,r){var e=[],h=[],l=r[i],o,a,v,c,u,s,f;for(h[i]=!0,e.push(l),o=t.WordsPerQuestion,a=r.length,u=1;u<o;++u)for(;;)if(f=Math.floor(Math.random()*a),!h[f]){e.push(r[f]);h[f]=!0;break}for(u=0;u<o;++u)f=Math.floor(Math.random()*o),v=e[f],e[f]=e[u],e[u]=v;for(c=-1,u=0;u<o;++u)if(e[u]===l){c=u;break}return s=this.m_language,s===n.ExamLanguageAnswers.RANDOM&&(f=Math.floor(Math.random()+.5),s=n.EnumConverter.ExamLanguageFromString(f.toString())),new n.QuestionMultiple(i,e,c,s)},t.prototype.reviewExam=function(){for(var n,r=this.m_questions.length,i=!0,t=0;t<r;++t)n=this.m_questions[t],n.hasAnswer()&&n.isCorrect()?this.m_view.questionPassed(n):(this.m_view.questionFailed(n),i=!1);i?this.m_view.examPassed():this.m_view.examFailed()},t.prototype.initEvents=function(){var n=this},t.prototype.remove=function(){var n=this.getControllerElement();n!=null&&n.parentNode.removeChild(n);this.m_questions=[]},t.WordsPerQuestion=3,t}();n.ExamMultipleController=t}(Exam||(Exam={})),function(n){var t=function(){function t(t){this.m_type=n.ExamType.SIMPLE;this.m_program=t;this.m_questions=[];this.m_view=new n.ExamSimpleView(this)}return t.prototype.add=function(n,t){t===void 0&&(t={});this.m_questions.length==0&&(this.m_testId=t.testId,this.m_language=t.language,this.getDataFromServer(n))},t.prototype.getControllerElement=function(){return document.getElementById("")},t.prototype.getDataFromServer=function(t){var r={testId:this.m_testId},i=this;n.Utility.AjaxPost("/exam/api/exam",r,function(n){if(!n.error&&(i.generateQuestions(n.words),n.html!="")){var u=n.html,r=document.createElement("div");r.innerHTML=u;t.appendChild(r.firstChild);i.m_view.renderQuestions(i.m_questions)}})},t.prototype.generateQuestions=function(n){var r=n.length,t,i;for(this.m_questions=[],t=0;t<r;++t)i=this.generateQuestion(t,n[t]),this.m_questions.push(i)},t.prototype.generateQuestion=function(t,i){var r=this.m_language,u;return r===n.ExamLanguageAnswers.RANDOM&&(u=Math.floor(Math.random()+.5),r=n.EnumConverter.ExamLanguageFromString(u.toString())),new n.QuestionSimple(t,i,r)},t.prototype.reviewExam=function(){for(var n,r=this.m_questions.length,i=!0,t=0;t<r;++t)n=this.m_questions[t],n.hasAnswer()&&n.isCorrect()?this.m_view.questionPassed(n):(this.m_view.questionFailed(n),i=!1);i?this.m_view.examPassed():this.m_view.examFailed()},t.prototype.initEvents=function(){var n=this},t.prototype.remove=function(){var n=this.getControllerElement();n!=null&&n.parentNode.removeChild(n);this.m_questions=[]},t}();n.ExamSimpleController=t}(Exam||(Exam={})),function(n){var t=function(){function t(n){this.m_program=n}return t.prototype.add=function(n,t){t===void 0&&(t={});var i=this.getControllerElement();i!=null?this.m_startButton==null&&this.initEvents():this.getDataFromServer(n)},t.prototype.getControllerElement=function(){return document.getElementById("startwrapper")},t.prototype.getDataFromServer=function(t){n.Utility.AjaxPost("/exam/api/start",{},function(n){if(!n.error){var r=n.html,i=document.createElement("div");i.innerHTML=r;t.appendChild(i.firstChild)}})},t.prototype.initEvents=function(){var t=this;this.m_startButton=document.getElementById("starttest");this.m_startButton.addEventListener("click",function(){var i=document.getElementById("testselector"),f;if(i.value!=""){var r=parseInt(i.value),u=i.options[i.selectedIndex],e=n.EnumConverter.ExamTypeFromString(u.getAttribute("data-type")),o=n.EnumConverter.ExamLanguageFromString(u.getAttribute("data-language"));r>0&&(f={testId:r,language:o,type:e},t.m_program.changeState(n.ExamState.CURRENT,t,f))}})},t.prototype.remove=function(){var n=this.getControllerElement();n!=null&&n.parentNode.removeChild(n);this.m_startButton=null},t}();n.StartController=t}(Exam||(Exam={})),function(n){var t=function(){function n(n){this.m_controller=n}return n.prototype.renderQuestions=function(n){var i=n.length,e=this,r=document.getElementById("template_multiple_answers"),u=document.getElementById("questions_list"),t,f;if(!r||!u)throw new Error("Can't find questions template or questions root");for(t=0;t<i;++t)this.renderQuestion(n[t],u,r,t==i-1);f=document.getElementById("submit");f.addEventListener("click",function(){e.m_controller.reviewExam()})},n.prototype.renderQuestion=function(n,t,i,r){function w(t){return function(){c||(c=!0,r?h.showSubmitButton():h.showNextQuestion(n));n.m_answer=t}}var h=this,c=!1,f=i.content.querySelector(".question-root"),y=i.content.querySelector(".id"),p=i.content.querySelector(".question"),e,l,a,u,o,s,v;for(y.innerHTML=(n.m_id+1).toString(),p.innerHTML=n.m_question,f.id="q_"+n.m_id,f.setAttribute("data-id",n.m_id.toString()),e=document.importNode(i.content,!0),n.m_id===0&&(f=e.querySelector(".question-root"),f.classList.remove("qhidden")),l=e.querySelectorAll(".answer"),a=n.m_words.length,u=0;u<a;++u)o=l[u],s=o.querySelector("input"),s.name="q_"+n.m_id,s.addEventListener("click",w(u)),v=o.querySelector(".answer-text"),v.innerHTML=n.m_words[u];t.appendChild(e)},n.prototype.showNextQuestion=function(n){var t=n.m_id+1,i=document.getElementById("q_"+t);if(!i)throw new Error("Could not find: q_"+t);i.classList.remove("qhidden")},n.prototype.showSubmitButton=function(){var n=document.getElementById("submit");n.classList.remove("hide")},n.prototype.examPassed=function(){console.log("TEST PASSED!!!")},n.prototype.examFailed=function(){console.log("exam failed!")},n.prototype.questionFailed=function(n){var t=document.getElementById("q_"+n.m_id).querySelector(" .question-container");t.classList.remove("passed");t.classList.add("failed")},n.prototype.questionPassed=function(n){var t=document.getElementById("q_"+n.m_id).querySelector(" .question-container");t.classList.remove("failed");t.classList.add("passed")},n}();n.ExamMultipleView=t}(Exam||(Exam={})),function(n){var t=function(){function n(n){this.m_controller=n}return n.prototype.getQuestionId=function(n){return"q_"+n},n.prototype.examPassed=function(){},n.prototype.examFailed=function(){},n.prototype.questionPassed=function(n){var t=document.getElementById(this.getQuestionId(n.m_id)).querySelector(" .question-container");t.classList.remove("failed");t.classList.add("passed")},n.prototype.questionFailed=function(n){var t=document.getElementById(this.getQuestionId(n.m_id)).querySelector(" .question-container");t.classList.remove("passed");t.classList.add("failed")},n.prototype.renderQuestions=function(n){var i=n.length,e=this,r=document.getElementById("template_simple_answers"),u=document.getElementById("questions_list"),t,f;if(!r||!u)throw new Error("Can't find questions template or questions root");for(t=0;t<i;++t)this.renderQuestion(n[t],u,r,t==i-1);f=document.getElementById("submit");f.addEventListener("click",function(){e.m_controller.reviewExam()})},n.prototype.renderQuestion=function(n,t,i,r){var h=this,c=!1,u,l=2e3,f=i.content.querySelector(".question-root"),a=i.content.querySelector(".id"),v=i.content.querySelector(".question"),e,o,s;a.innerHTML=(n.m_id+1).toString();v.innerHTML=n.m_question;f.id=this.getQuestionId(n.m_id);f.setAttribute("data-id",n.m_id.toString());e=document.importNode(i.content,!0);n.m_id===0&&(f=e.querySelector(".question-root"),f.classList.remove("qhidden"));o=function(){c||(u&&(clearTimeout(u),u=null),c=!0,r?h.showSubmitButton():h.showNextQuestion(n))};s=e.querySelector(".answer");s.addEventListener("input",function(){u&&(clearTimeout(u),u=null);u=setTimeout(function(){o()},l);n.m_answer=this.value});s.addEventListener("blur",function(){this.value!=""&&o()});t.appendChild(e)},n.prototype.showNextQuestion=function(n){var t=n.m_id+1,i=document.getElementById(this.getQuestionId(t));if(!i)throw new Error("Could not find: q_"+t);i.classList.remove("qhidden")},n.prototype.showSubmitButton=function(){var n=document.getElementById("submit");n.classList.remove("hide")},n}();n.ExamSimpleView=t}(Exam||(Exam={})),function(n){var t=function(){function t(t,i,r,u){var f,o,e;this.m_id=t;this.m_words=[];this.m_correctAnswer=r;this.m_answer=-1;f="";switch(u){case n.ExamLanguageAnswers.UL:this.m_question=i[r].finnish;f="translation";break;case n.ExamLanguageAnswers.FI:this.m_question=i[r].translation;f="finnish"}for(o=i.length,e=0;e<o;++e)this.m_words.push(i[e][f])}return t.prototype.isCorrect=function(){return this.m_answer===this.m_correctAnswer},t.prototype.hasAnswer=function(){return this.m_answer>=0},t}();n.QuestionMultiple=t}(Exam||(Exam={})),function(n){var t=function(){function t(t,i,r){this.m_id=t;this.m_answer="";switch(r){case n.ExamLanguageAnswers.UL:this.m_question=i.finnish;this.m_correctAnswer=i.translation.toLocaleLowerCase();break;case n.ExamLanguageAnswers.FI:this.m_question=i.translation;this.m_correctAnswer=i.finnish.toLocaleLowerCase()}}return t.prototype.isCorrect=function(){return this.m_answer.toLocaleLowerCase()===this.m_correctAnswer},t.prototype.hasAnswer=function(){return this.m_answer!=""},t}();n.QuestionSimple=t}(Exam||(Exam={}));